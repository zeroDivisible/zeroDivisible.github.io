<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>Gradle: adding new sourceSets while using IntelliJ Idea - null log</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="/gradle-adding-new-sourcesets-while-using-intellij-idea.html">

        <meta name="author" content="Michal Stolarczyk" />
        <meta name="keywords" content="gradle,intellij-idea" />
        <meta name="description" content="From time to time having normal tests configured in my Gradle build files is not enough - especially when I&#39;m dealing with big, multi-module projects. There might be a need to either create a functional test or maybe test the behaviour of code while playing with new library. If unit ..." />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.myunited.min.css" type="text/css"/>
    <link href="/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="/theme/css/pygments/colorful.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>
        <link href="/static/custom.css" rel="stylesheet">


</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">
null log            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="/category/blog.html">Blog</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-lg-12">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/gradle-adding-new-sourcesets-while-using-intellij-idea.html"
                       rel="bookmark"
                       title="Permalink to Gradle: adding new sourceSets while using IntelliJ Idea">
                        Gradle: adding new sourceSets while using IntelliJ Idea
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="published">
        <time datetime="2014-01-10T11:44:08+00:00"> Fri 10 January 2014</time>
    </span>



	<a href="/tag/gradle.html">gradle</a>
        /
	<a href="/tag/intellij-idea.html">intellij-idea</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>From time to time having normal tests configured in my <code>Gradle</code> build files is not enough - especially when I'm dealing with big, multi-module projects. There might be a need to either create a functional test or maybe test the behaviour of code while playing with new library. If unit tests are not enough in this case, it's better to create some kind of functional or integration one, especially that once it's done in a structured way, your colleagues will know where to go if they want to check something. </p>
<h3>Gradle</h3>
<p>In one project which I was working on, there was a need to add functionl tests - which is easilly doable in Gradle by introducing new sourceSets and new test task:</p>
<div class="highlight"><pre><span class="n">sourceSets</span> <span class="o">{</span>

   <span class="c1">// all other source sets</span>

   <span class="n">funcTest</span> <span class="o">{</span> <span class="n">test</span> <span class="o">-&gt;</span>
      <span class="n">compileClasspath</span> <span class="o">=</span> <span class="n">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">.</span><span class="na">output</span> <span class="o">+</span> <span class="n">sourceSets</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">output</span> <span class="o">+</span> <span class="n">configurations</span><span class="o">.</span><span class="na">testRuntime</span>
      <span class="n">runtimeClasspath</span> <span class="o">=</span> <span class="n">output</span> <span class="o">+</span> <span class="n">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">.</span><span class="na">output</span> <span class="o">+</span> <span class="n">sourceSets</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">output</span> <span class="o">+</span> <span class="n">configurations</span><span class="o">.</span><span class="na">testRuntime</span>

      <span class="n">java</span><span class="o">.</span><span class="na">srcDirs</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;src/functest/java&#39;</span><span class="o">]</span>
      <span class="n">resources</span><span class="o">.</span><span class="na">srcDirs</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;src/functest/resources/&#39;</span><span class="o">]</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>The above defines a source set called <code>funcTest</code>, which references sources from <code>src/functest/java</code> in current project and resources from <code>src/functest/resources</code>. It also is based on outputs from <code>main</code> &amp; <code>test</code> sourceSets (which are defined earlier in a similar manner and not shown here).</p>
<p>This alone is almost sufficient for gradle - if we want to refernce this source set from a gradle task (because currently it just exists without doing anything), we can create one:</p>
<div class="highlight"><pre><span class="n">task</span> <span class="nf">funcTest</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Test</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">testClassesDir</span> <span class="o">=</span> <span class="n">sourceSets</span><span class="o">.</span><span class="na">funcTest</span><span class="o">.</span><span class="na">output</span><span class="o">.</span><span class="na">classesDir</span>
   <span class="n">classpath</span> <span class="o">=</span> <span class="n">sourceSets</span><span class="o">.</span><span class="na">funcTest</span><span class="o">.</span><span class="na">runtimeClasspath</span>
<span class="o">}</span>
</pre></div>


<p>This ads a <code>funcTest</code> Gradle task (of type <code>Test</code>) and configures classpath for it. Name doesn't need to match the name of previously created sourceSet as the biding part happens in <code>sourceSets.funcTest.output.classesDir</code>. If it matches though, it will easilly show the relationship between those two. As usual with Gradle, you can run new task by typing </p>
<div class="highlight"><pre><span class="n">gradle</span> <span class="n">funcTest</span>
</pre></div>


<p>in the command line.</p>
<h3>IntelliJ Idea</h3>
<p>So, now once Gradle is configured and will work on it's own, the next step is to make it work with Idea. Idea has really nice (though not flawless) integration with Gradle, but somehow it's not able to automatically deduct that we had just defined new test sources based on what we had just configured. Fix is quite easy though and it requires:</p>
<ol>
<li>Importing <code>idea</code> plugin in the build file (if it's not done yet):</li>
</ol>
<div class="highlight"><pre><span class="kn">import</span> <span class="err">&#39;</span><span class="nn">idea</span><span class="err">&#39;</span>
</pre></div>


<ol>
<li>Configuring the plugin to recognise directories with fuctional tests as test directories, not source ones:</li>
</ol>
<div class="highlight"><pre><span class="n">idea</span> <span class="o">{</span>
   <span class="n">module</span> <span class="o">{</span>
      <span class="n">testSourceDirs</span> <span class="o">+=</span> <span class="n">file</span><span class="o">(</span><span class="s1">&#39;src/functest/java&#39;</span><span class="o">)</span>
      <span class="n">testSourceDirs</span> <span class="o">+=</span> <span class="n">file</span><span class="o">(</span><span class="s1">&#39;src/functest/resources&#39;</span><span class="o">)</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>And hopefully, now after either importing or refreshing the project using JetGradle it should get properly recognised.</p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Michal Stolarczyk
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>

    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = '/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'zeroDivisible',
                count: 5,
                skip_forks: false,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->
</body>
</html>